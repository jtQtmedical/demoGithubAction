name: Crawler Demo Action
run-name: Crawler Demo Action

# è§¸ç™¼æ­¤ action çš„æ™‚æ©Ÿ
on:
  schedule:
    - cron: "55 12 * * *"  # UTC æ¯å¤©ä¸‹åˆ 12:55 åŸ·è¡Œæ­¤ actionï¼ˆç­‰åŒæ–¼å°ç£æ™šä¸Š 8:55 åŸ·è¡Œï¼‰
  workflow_dispatch:  # å¯ä»¥æ‰‹å‹•åŸ·è¡Œæ­¤ action

# é å…ˆå®šç¾©æ­¤ action è¦å¹¹å˜›
jobs:
  crawler-demo:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # çµ¦äºˆå¯«å…¥æ¬Šé™ï¼Œå…è¨± push åˆ° repository
    steps:
      - name: Checkout
        uses: actions/checkout@v4  # æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
        with:
          token: ${{ secrets.GITHUB_TOKEN }}  # ä½¿ç”¨ GitHub Token
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      
      - name: Install Python Dependencies
        run: |
          pip install requests
          pip install beautifulsoup4
          pip install lxml
          pip install selenium
          pip install scrapy
      
      - name: Run crawler.py
        run: python crawler.py
        env:
          # å¯ä»¥åœ¨é€™è£¡è¨­å®šçˆ¬èŸ²éœ€è¦çš„ç’°å¢ƒè®Šæ•¸
          CRAWLER_TIMEOUT: 30
          CRAWLER_RETRY: 3
      
      - name: Check for changes
        id: check_changes
        run: |
          if [[ -n "$(git status --porcelain)" ]]; then
            echo "has_changes=true" >> $GITHUB_OUTPUT
          else
            echo "has_changes=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Commit and Push Data
        if: steps.check_changes.outputs.has_changes == 'true'
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "ðŸ¤– Auto update: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          git push origin main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: No changes detected
        if: steps.check_changes.outputs.has_changes == 'false'
        run: echo "No changes detected, skipping commit"